# サーマルフュージョンシステム "Day Dream" (下書き中)
## 概要
夢ビジョンの映像に熱源を可視化した映像を重ね合わせる、いわゆる『フュージョン』と呼ばれる視界を実現するシステムです。  
夢ビジョン単体ではIRライトの補助がないと完全暗所で視界を確保するのは厳しいですが、本機はサーマルの支援を受けることで視界の中の人物などを強調し、使い方次第では昼間でも偽装などに対する強力な視覚補助を得ることができます。  
| 通常時 | White Hot | Black Hot | Outline |
| :---: | :---: | :---: | :---: |
| ![image](https://github.com/Qoo622/3D-print/assets/65710525/5cf21327-2818-40a5-bbc2-44afdcdadbb0) | ![image](https://github.com/Qoo622/3D-print/assets/65710525/88b0790c-39fb-4b3b-a2e1-db517ec5b57d) | ![image](https://github.com/Qoo622/3D-print/assets/65710525/456e9644-8a39-4e03-a99b-60ad7365d88d) | ![image](https://github.com/Qoo622/3D-print/assets/65710525/de3e3392-6557-4711-b6ad-febd5f055434) |

ホワイトホット・ブラックホットの切り替えだけでなく特徴的な熱源の輪郭だけを強調するアウトライン表示など、本来は高価な軍用サーマルで得られる視覚強化を疑似体験できることが最大の特徴です。  
大まかな仕組みとしてはスマートフォン用サーマルカメラで取得した映像をRaspberry Pi（今回はZero2W）を用いてPythonで画像処理し小型モニターへ出力、ビームスプリッターを用いて映像を合成しています。  

名称は"Day Dream（白昼夢）"としました。これには以下の意味が込められています。 　
- サーマルシステムの補助により昼間にも利用可能であること
- 不可能と思われた幻覚＝白昼夢を実現したこと
- 先行公開時にいただいたリアクション「こんなん白昼夢やん！」より

ソフトウェアの構築・ハードウェアの選定など、今回コアとなる部分のほとんどは友人のgb7k氏に構築いただきました。アホな白昼夢を現実にしてくれてありがとうオタク……。  

## 組み立てに関する注意事項
本システムの再現には以下を達成できるだけの知識と技術を必要とします。
- Raspberry Pi上でPythonコードを走らせられること(環境構築など)
- CUIを用いてPythonコードを自環境に合わせて調整できること
- ガーバデータを納品して基板発注ができること
- 納品された基板に各種スイッチ・コネクタ類を調達した上でハンダ付けが可能なこと
- XHコネクタ等を用いてケーブルを自作できること

当方ではサポートを行えませんので、DIYでの挑戦には相応のハードルがあるとお考えください。  
これまでの弊キットのようなデータをDLして印刷して組み立て…とはレベルの異なる難易度となります。ドキュメントやデータ、ノウハウを公開しているものの、友人も私もほとんど再現不可能だと思いながらこれを書いています。  

## 必要なもの
| item | Description | Number |
| :--- | :--- | :---: |
| Upper/Lower/Button類/Monitor-Frame/Filter系 | 本キットのコア部分。用いるマウント方法に合わせて選択してください。G43マウントにはおそらく対応していません | 1つずつ |
| YUME_v2.0_Front-TH | レンズモジュールおよびサーマルカメラを固定します。（使用するサーマルカメラに合わせて選択してください） | 1つ |
| YUME_v2.0_Prism-Holder | ビームスプリッターと出力用モニターを固定します。 | 1つ |
| YUME_v2.0_Rear-TH | 接眼レンズを固定します。 | 1つ |
| YUME_v2.0_Thermal-Holder_a/b | サーマルカメラおよびケーブルの固定に使用します。（使用するサーマルカメラに合わせて選択してください） | 1つずつ |
| ビームスプリッタープリズム | [アリエクのこちら](https://ja.aliexpress.com/item/1005005357029790.html)など、25.4mm角のものを調達してください。 | 1つ |
| スマホVR用接眼レンズ | 通常のヘルメットマウント用のものと同じものです。 | 1つ |
| 2.8mm CSマウント IRレンズ | 通常ヘルメットマウントで推奨しているレンズです。視野を重ねる関係でこの手の広角レンズに合わせてプログラムを設定しています。 | 1つ |
| スマホ用サーマルカメラ | 現時点ではinfiRay P2 Pro もしくは Hikmicro Mini2に対応しています。 | いずれか1つ |
| Raspberry　Pi Zero2W | 演算処理に用います。ヒートシンクも準備してください。高価で大型化を許容できるならPi4Bでも問題ありません。 | 1つ |
| 操作用基板 | JLCPCB等に依頼して基板を作成してもらってください。また、別途スイッチ等のハンダ付けが必要です。 | 1つ |
| M3x30mmキャップボルト | Rear側の固定に使用します。 | 4本 |
| M3x25mmキャップボルト | サーマルユニットの固定に使用します。 | 2本 |
| M3xnmmキャップボルト | プリズムの固定に使用します。 | 1つ |
| M3ナット | 各種固定に用います。 | n個 |
| M2x16mm皿ネジ+M2ナット | 出力用小型モニターの固定に使用します。 | 2組 |
| USB-C 90度アングルアダプター | ケーブルの取り回し向上に用います。[Amazonのこの辺など](https://amzn.asia/d/7SX1Yx4)を買ってください。 | 1つ |
| USB-Cメス to　Cオスケーブル | サーマルカメラからの映像をラズベリーパイに伝送するのに用います。ヘルメットマウントの場合は4-50cm程度のものを調達してください。 | 1つ |
| USB-Cメス to micro-Bオスアダプター | サーマルカメラからの映像をラズベリーパイに伝送するのに用います。OTG対応のものが必要です。90度曲がったタイプだと接続しやすいです。 | 1つ |
| USB-A to micro-Bオスケーブル | モバイルバッテリーからラズベリーパイに給電するのに用います。 | 1つ |
| 1.54インチディスプレイ | 240x240 ドライブICはST7789指定。[アリエクこの辺など](https://ja.aliexpress.com/item/1005005810192385.html)を買ってください。XHコネクタを接続しておいてください。| 1つ |
| スリムロボットケーブル | 操作用基板からモニターへ出力するのに用います。[Amazonのこの辺](https://www.amazon.co.jp/dp/B01HARB72A)を買って、両端に8ピンのXHコネクタを接続してください。ヘルメットマウントで60cm程度が必要です。 | 1本 |
| モバイルバッテリー | Raspberry Piの電源として用います。（仕様次第では夢ビジョン本体の電源と共用可能です） | 1つ |
| YUME_v2.0_Prism-Holder_normal | 双眼運用する場合、サーマルを仕込まない方にもプリズムを入れて立体視を維持するのに用います。プリズムと合わせて準備してください。 | 1つ |

※一部電装系についてはgb7k氏の記述と重複します。[gb7k氏の「必要な機材」の章](https://github.com/gb7k/Day_Dream-Yume_Thermal-#%E5%BF%85%E8%A6%81%E3%81%AA%E6%A9%9F%E6%9D%90)も合わせて参照してください。

## 作業工程
### 0. 操作系統用基板およびRaspberry Piの環境準備
  - [gb7k氏側のReadme](https://github.com/gb7k/Day_Dream-Yume_Thermal-)を参照ください。
  - こちらの基板作成〜動作確認までを完了させておいてください。
### 1. 通常通り夢ビジョンを分解しUpperおよびLowerとコア部分を組み立てる
![image](https://github.com/Qoo622/3D-print/assets/65710525/362d1e66-35fd-4711-8e4e-4c49714d07a2)
  - ここは通常のものと変わりません。  
  - すでに組み立て済みのキットがある場合はFrontとRearを外しておいてください。
### 2. Prism-Holderにプリズムとディスプレイを固定する
![image](https://github.com/Qoo622/3D-print/assets/65710525/1bcc80bf-b410-4669-8b07-35e51f8decbc)
  - プリズムを挿入する際は向きに注意してください。
  - ディスプレイはまずXHコネクタをつけたロボットケーブルをセットしておきます。
  - Prism-HolderにM2ナットを挿入した後、ディスプレイのXHコネクタを入れていない側を差し込んでネジ穴にM2ネジを通す形で固定してください。
### 3. Rear-THに接眼レンズを接着する
![image](https://github.com/Qoo622/3D-print/assets/65710525/de496d26-33b4-40af-aa00-9a5d25b6970f)
  - こちらも通常のものと変わりません。
### 4. Rear-TH周りを組み立てる
![image](https://github.com/Qoo622/3D-print/assets/65710525/7d938bff-e2de-4993-a814-869a28025123)
  - Upper/Lower　→ Filter-dial →　Filter-dial-frame →　Prism-Holder →　Rear-THの順になるように重ねてください。
  - 全体をM3x30mmキャップボルトで固定してください。この際、ケーブルを穴に通すようにします。少し狭いので挟み込みに注意してください。
    - 穴が狭くて挟んでしまう場合はヤスリ等で削って調整してください。
> [!TIP]
> Monitor-Frameに夢側のモニターをズレなく固定できると後で位置合わせが楽になります。必要に応じてスペーサーやデータの調整等で精度を上げておくことをおすすめします。
### 5. Front-THにサーマルカメラとレンズユニットを固定する。
![image](https://github.com/Qoo622/3D-print/assets/65710525/a190c29a-debe-43bb-847b-2d06ff8b967e)
![image](https://github.com/Qoo622/3D-print/assets/65710525/ccdb1828-2892-4b29-9318-9726df47663d)
  - サーマルカメラには90度アダプターを介してUSBケーブルを接続しておきます。
  - サーマルカメラをFrontに差し込み、Thermal-Holderで挟み込むようにしてM3x25mmネジとナットで固定します。
  - レンズユニットは通常のキット通り組み込みます。
    - アプリケーションは焦点距離2.8mmの広角レンズを想定して数値を設定してあります。特段の事情がなければこちらを用いてください。
> [!NOTE]
> こちらの説明画像はP2Pro用です。Hikmicro mini2を用いる場合はレイアウトと必要パーツが多少変わります。
### 6. 全体を組み上げる
![image](https://github.com/Qoo622/3D-print/assets/65710525/e2647bbb-b550-4dfb-8c37-b17736911838)
  - M3ネジとナットで固定してください。（通常キットと変わりません）
### 7. Pythonコードを調整し、映像のズレを修正する
  - 組み立て直後の状態では夢ビジョン側の映像とサーマル側の映像にはズレが生じます。
  - 一度システムをシャットダウンした後、HDMIモニターとキーボードをRaspberry Piに接続し再度立ち上げてください。
  - [gb7k氏のReadme内「投影位置調整」の章](https://github.com/gb7k/Day_Dream-Yume_Thermal-#%E6%8A%95%E5%BD%B1%E4%BD%8D%E7%BD%AE%E8%AA%BF%E6%95%B4)を参考に、各種数値を操作して位置合わせを実施してください。
    - アプリケーションの編集は立ち上げ状態では行えません。確認→アプリ終了→編集→アプリ立ち上げ→確認→アプリ終了→編集…を位置合わせ完了まで繰り返してください。
  - アウトライン表示は別アプリになっていますが、基本的に同じ値で重ねられます。まずどちらかで合わせたのち、他方を同じ値にして調整を行なってください。

## 注意事項
- システムを起動したまま電源を抜かないでください
  - 環境が破損し、起動ができなくなる恐れがあります。
