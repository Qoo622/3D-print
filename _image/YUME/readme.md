# サーマルフュージョンシステム "Day Dream"
## 概要
スマートフォン用のサーマルカメラを組み合わせることで、夢ビジョンの映像に熱源を可視化した映像を重ね合わせる『フュージョン』と言われる視界を実現するシステムです。  
大まかな仕組みとしてはサーマルカメラで取得した映像をRaspberry Pi（今回はZero2W）を用いてPythonで画像処理し小型モニターへ出力、ビームスプリッターを用いて映像を合成しています。  
名称は"Day Dream（白昼夢）"としました。これには以下の意味が込められています。 　
- サーマルシステムの補助により昼間にも利用可能であること
- 不可能と思われた幻覚＝白昼夢を実現したこと
- 先行公開時にいただいたリアクション「こんなん白昼夢やん！」より

## 搭載機能
- 夢ビジョンIR画像へのサーマルフュージョン
  - ホワイトホット/ブラックホットの切り替え
  - アウトライン表示モードへの切り替え
  - サーマル映像の輝度調整機能（無段階）
- コード調整により以下を実現可能
  - 起動時のデフォルト輝度の変更

## 組み立てに関する注意事項
本システムの再現には以下を達成できるだけの知識と技術を必要とします。
- Raspberry Pi上でPythonコードを走らせられること
- CLIを用いてPythonコードを自環境に合わせて調整できること
- ガーバーデータを納品して基板発注ができること
- 納品された基板に各種スイッチ・コネクタ類を調達した上でハンダ付けが可能なこと
- XHコネクタ等を用いてケーブルを自作できること

当方ではサポートを行えませんので、DIYでの挑戦には相応のハードルがあるとお考えください。 　
これまでの弊キットのようなデータをDLして印刷して組み立て…とはレベルの異なる難易度となります。ドキュメントやデータ、ノウハウを公開しているものの、ほとんど再現不可能だと思いながらこれを書いています。  
そのためPythonコードおよび基板発注用のガーバーデータについては、作者である友人の意向により上記をご了承いただけるご希望者の方にのみ提供します。チャレンジされる方はDM等にてコンタクトください。

## 必要なもの
| item | Description | Number |
| :--- | :--- | :---: |
| Upper/Lower/Button類/Monitor-Frame/Filter系 | 本キットのコア部分。用いるマウント方法に合わせて選択してください。G43マウントにはおそらく対応していません | 1つずつ |
| YUME_v2.0_Front-TH | レンズモジュールおよびサーマルカメラを固定します。（使用するサーマルカメラに合わせて選択してください） | 1つ |
| YUME_v2.0_Prism-Holder | ビームスプリッターと出力用モニターを固定します。 | 1つ |
| YUME_v2.0_Rear-TH | 接眼レンズを固定します。 | 1つ |
| YUME_v2.0_Thermal-Holder_a/b | サーマルカメラおよびケーブルの固定に使用します。（使用するサーマルカメラに合わせて選択してください） | 1つずつ |
| ビームスプリッター | [アリエクのこちら]()など、1インチ角のものを調達してください。 | 1つ |
| スマホVR用接眼レンズ | 通常のヘルメットマウント用のものと同じものです。 | 1つ |
| スマホ用サーマルカメラ | 現時点ではinfiRay P2 Pro / Hikmikro Mini2に対応しています。 | いずれか1つ |
| Raspberr　Pi Zero2W | 演算処理に用います。放熱用のケースも準備してください。 | 1つ |
| 操作用基板 | JLCPCB等に依頼して基板を作成してもらってください。また、別途スイッチ等のハンダ付けが必要です。 | 1つ |
| M3x30mmキャップボルト | Rear側の固定に使用します。 | 4本 |
| M3x16mmキャップボルト | サーマルユニットの固定に使用します。 | 2本 |
| M3xnmmキャップボルト | プリズムの固定に使用します。 | 1つ |
| M3ナット | 各種固定に用います。 | n個 |
| M2xNmm皿ネジ+M2ナット | 出力用小型モニターの固定に使用します。 | 2組 |
| USB-C 90度アングルアダプター | ケーブルの取り回し向上に用います。[Amazonのこの辺など]()を買ってください。 | 1つ |
| USB-Cメス to　Cオスケーブル | サーマルカメラからの映像をラズベリーパイに伝送するのに用います。ヘルメットマウントの場合は4-50cm程度のものを調達してください。 | 1つ |
| USB-Cメス to micro-Bオスアダプター | サーマルカメラからの映像をラズベリーパイに伝送するのに用います。OTG対応のものが必要です。90度曲がったタイプだと接続しやすいです。 | 1つ |
| USB-A to micro-Bオスケーブル | モバイルバッテリーからラズベリーパイに給電するのに用います。 | 1つ |
| nインチディスプレイ | ST7789のもの。[アリエクこの辺など]()を買ってください。XHコネクタを接続しておいてください。| 1つ |
| スリムロボットケーブル | 操作用基板からモニターへ出力するのに用います。[Amazonのこの辺]()を買って、両端に8ピンのXHコネクタを接続してください。ヘルメットマウントで60cm程度が必要です。 | 1本 |
| YUME_v2.0_Prism-Holder_normal | 双眼運用する場合、サーマルを仕込まない方にもプリズムを入れて立体視を維持するのに用います。プリズムと合わせて準備してください。 | 1つ |

## 作業工程
### **1. 通常通り夢ビジョンを分解しUpperおよびLowerとコア部分を組み立てる**
  - ここは通常のものと変わりません。  
  - すでに組み立て済みのキットがある場合はFrontとRearを外しておいてください。
### **2. Prism-Holderにプリズムとディスプレイを固定する**
  - プリズムを挿入する際は向きに注意してください。
  - ディスプレイはまずXHコネクタをつけたロボットケーブルをセットしておきます。
  - Prism-HolderにM2ナットを挿入した後、ディスプレイのXHコネクタを入れていない側を差し込んでネジ穴にM2ネジを通す形で固定してください。
### **3. Rear-THに接眼レンズを接着する**
  - こちらも通常のものと変わりません。
### **4. Rear-TH周りを組み立てる**
  - Upper/Lower　→ Filter-dial →　Filter-dial-holder →　Prism-Holder →　Rear-THの順になるように重ねてください。
  - 全体をM3x30mmキャップボルトで固定してください。この際、ケーブルを穴に通すようにします。少し狭いので挟み込みに注意してください。
    - 穴が狭くて挟んでしまう場合はヤスリ等で削って調整してください。
> [!NOTE]
> Monitor-Frameに夢側のモニターをズレなく固定できると後で位置合わせが楽になります。必要に応じてスペーサーやデータの調整等で精度を上げておくことをおすすめします。
### **5. Front-THにサーマルカメラを固定する。**
  - サーマルカメラには90度アダプターを介してUSBケーブルを接続しておきます。
  - サーマルカメラをFrontに差し込み、Thermal-Holderで挟み込むようにして固定します。
  - レンズユニットは通常のキット通り組み込みます。
    - アプリケーションは焦点距離2.8mmの広角レンズを想定して数値を設定してあります。特段の事情がなければこちらを用いてください。
  - M3ネジとナットで固定してください。（通常キットと変わりません）
### **6. Raspberry Pi用のMicroSDにOSと各Pythonコードを書き込んでおく**
＜準備中＞
  - Pythonコードは希望者にのみ配布する形で公開します。
### **7. 操作系統用基板を発注し、タクトスイッチをハンダ付けする**
  - 操作系統用基板はJLCPCB等にガーバーデータを投げて発注してください。
    - 依頼用データは希望者にのみ配布します。
  - タクトスイッチは全部で6個必要になります。
### **8. 操作系統用基板およびカメラケーブル類をラズベリーパイに接続する**
  - サーマルカメラからはUSB-Cからmicro-Bへ変換して接続してください
  - 操作系統用基板とRaspberry Piの固定には適当な治具を作成してください。
   　- 作者の雑設計データでよければ希望者には提供します。
> [!NOTE]
> 操作系統用基板とRaspberry Piの距離が近すぎるとノイズが乗り動作が不安定になります。適当な40ピンコネクタを挟んで下駄を履かせると安定性が向上します。
### **9. OSおよびアプリを書き込んだmicroSDを挿入し、電源を入れて起動する**
  - 電源を投入するとシステムが立ち上がり起動アニメーションが流れます。
  - その後Appボタンを押してアプリを立ち上げて動作確認を行なってください。
### **10. Pythonコードを調整し、映像のズレを修正する**
  - 組み立て直後の状態では夢ビジョン側の映像とサーマル側の映像にはズレが生じます。
  - 一度システムをシャットダウンした後、HDMIモニターとキーボードをRaspberry Piに接続し再度立ち上げてください。
  - コマンド経由でアプリケーションの編集画面に入り、各種数値を操作して位置合わせを実施してください。
    - アプリケーションの編集は立ち上げ状態では行えません。確認→アプリ終了→編集→アプリ立ち上げ→確認→アプリ終了→編集…を位置合わせ完了まで繰り返してください。
  - アウトライン表示は別アプリになっていますが、基本的に同じ値で重ねられます。まずどちらかで合わせたのち、他方を同じ値にして調整を行なってください。
  - アプリケーション編集等のガイドについては組み立てが完了された方にのみ配布とします。DM等でコンタクトください。

## 注意事項
- システムを起動したまま電源を抜かないでください
  - 環境が破損し、起動ができなくなる恐れがあります。
